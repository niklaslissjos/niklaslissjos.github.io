<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niklas Lissjos</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0f0f0f;
            color: #f0f0f0;
            line-height: 1.6;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
            position: relative;
            overflow: hidden;
        }
        #content {
            padding: 20px;
            text-align: right;
            position: relative;
            z-index: 2;
        }
        h1 {
            margin-bottom: 10px;
        }
        a {
            color: #ff6a00;
        }
        .glitch {
            position: absolute;
            background: #f0f0f0;
            width: 100%;
            height: 2px;
            opacity: 0.2;
            animation: glitch-animation 0.2s linear;
        }
        .glitch-intense {
            height: 4px;
            opacity: 0.4;
            box-shadow: 0 0 10px rgba(240, 240, 240, 0.5);
        }
        @keyframes glitch-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <div id="content">
        <h4>Published by Niklas Lissjos</h4>
        This site is not broken, it's glitchy by design.
        <p>Solar radiation in Stockholm: <span id="radiation-value">Loading...</span> kW/m²</p>
    </div>
    <script>
        function createGlitch(intense = false) {
            const glitch = document.createElement('div');
            glitch.className = 'glitch' + (intense ? ' glitch-intense' : '');
            glitch.style.top = Math.random() * window.innerHeight + 'px';
            document.body.appendChild(glitch);
            
            setTimeout(() => {
                document.body.removeChild(glitch);
            }, 200);
        }

        function simulateBadConnection() {
            const glitchCount = Math.floor(Math.random() * 3) + 1; // 1 to 3 glitches at a time
            for (let i = 0; i < glitchCount; i++) {
                createGlitch(Math.random() < 0.3); // 30% chance of intense glitch
            }
            const nextGlitch = Math.random() * 500 + 100; // Random time between 0.1 and 0.6 seconds
            setTimeout(simulateBadConnection, nextGlitch);
        }

        simulateBadConnection();

        // Call the function when the page loads
        updateSolarRadiation();

        // NASA POWER API call and update
        async function updateSolarRadiation() {
            const lat = 59.3293; // Stockholm latitude
            const lon = 18.0686; // Stockholm longitude
            
            // Use yesterday's date
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const start = Math.floor(yesterday.getTime() / 86400000); // Convert to days since 1970-01-01
            const end = start; // Same as start for single day
            
            const parameters = 'ALLSKY_SFC_SW_DWN'; // All Sky Surface Shortwave Downward Irradiance
            const apiUrl = `https://power.larc.nasa.gov/api/temporal/daily/point?parameters=${parameters}&community=RE&longitude=${lon}&latitude=${lat}&start=${start}&end=${end}&format=JSON`;

            try {
                console.log('Fetching data from:', apiUrl);
                const response = await fetch(apiUrl);
                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers));
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response body:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Received data:', data);
                
                // Check if the data has the expected structure
                if (data && data.properties && data.properties.parameter && data.properties.parameter[parameters]) {
                    const dateKey = Object.keys(data.properties.parameter[parameters])[0];
                    const radiationValue = data.properties.parameter[parameters][dateKey];
                    document.getElementById('radiation-value').textContent = (radiationValue / 1000).toFixed(3); // Convert W/m² to kW/m²
                } else {
                    throw new Error('Unexpected data structure received from API');
                }
            } catch (error) {
                console.error('Error fetching solar radiation data:', error);
                console.error('Error details:', error.message);
                document.getElementById('radiation-value').textContent = 'unavailable';
            }
            
            // Update every hour (3600000 ms)
            setTimeout(updateSolarRadiation, 3600000);
        }
    </script>
</body>
</html>