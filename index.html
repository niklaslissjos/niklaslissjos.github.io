<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niklas Lissjos</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0f0f0f;
            color: #f0f0f0;
            line-height: 1.6;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
            position: relative;
            overflow: hidden;
        }
        #content {
            padding: 20px;
            text-align: right;
            position: relative;
            z-index: 2;
        }
        h1 {
            margin-bottom: 10px;
        }
        a {
            color: #ff6a00;
            text-decoration: none;  /* This removes the underline */
        }
        /* If you want to add an underline on hover, you can use this: */
        a:hover {
            text-decoration: underline;
        }
        .glitch {
            position: absolute;
            background: #f0f0f0;
            width: 100%;
            height: 2px;
            opacity: 0.2;
            animation: glitch-animation 0.2s linear;
        }
        .glitch-intense {
            height: 4px;
            opacity: 0.4;
            box-shadow: 0 0 10px rgba(240, 240, 240, 0.5);
        }
        @keyframes glitch-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .solar-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: left;
            background-color: rgba(15, 15, 15, 0.7);
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            width: 500px;
        }

        .solar-info h3 {
            margin-top: 0;
        }

        .solar-info p {
            margin-bottom: 10px;
        }

        .solar-info small {
            display: block;
            margin-top: 20px;
            font-style: italic;
        }

        .copyright {
            position: fixed;
            top: 26%;
            right: 0;
            transform: rotate(-90deg) translateY(-50%);
            transform-origin: right center;
            font-size: 12px;
            color: #808080;
            padding: 10px;
            white-space: nowrap;
            z-index: 9999;
        }
    </style>
</head>
<body>

    <div class="solar-info">
        <p>Solar Radiation in San Diego: 
            <span id="radiation-value">Loading...</span> 
            <span id="radiation-unit"></span>
        </p>
        <p id="radiation-timestamp"></p>
        

        <small>/ Data provided by NASA POWER Project. This value represents the daily average of all sky surface shortwave downward irradiance for the previous day in San Diego, California. It's updated hourly and helps in understanding the solar energy potential in the area.</small>
    
    
        <br><br>


        <p>
            <a href="thesis.html" style="color: #ff6a00;">
            <small>Off-Grid Photovoltaics System Design and Simulation:
            <br>A Case Study Using Irradiation Data</small></a>
        </p>
    </div>


    <div id="content">
        <small>This site is not broken, it's glitchy by design.</small>
    </div>

    <div class="copyright">
        Copyright &copy; <span id="year"></span><b> / Built by Niklas Lissjos</b>
    </div>

    <script>
        function createGlitch(intense = false) {
            const glitch = document.createElement('div');
            glitch.className = 'glitch' + (intense ? ' glitch-intense' : '');
            glitch.style.top = Math.random() * window.innerHeight + 'px';
            document.body.appendChild(glitch);
            
            setTimeout(() => {
                document.body.removeChild(glitch);
            }, 200);
        }

        function simulateBadConnection() {
            const glitchCount = Math.floor(Math.random() * 3) + 1; // 1 to 3 glitches at a time
            for (let i = 0; i < glitchCount; i++) {
                createGlitch(Math.random() < 0.3); // 30% chance of intense glitch
            }
            const nextGlitch = Math.random() * 500 + 100; // Random time between 0.1 and 0.6 seconds
            setTimeout(simulateBadConnection, nextGlitch);
        }

        simulateBadConnection();

        // Call the function when the page loads
        updateSolarRadiation();

        // NASA POWER API call and update
        async function updateSolarRadiation() {
            const lat = 32.7157; // San Diego latitude
            const lon = -117.1611; // San Diego longitude
            
            // Use today's date in YYYYMMDD format
            const today = new Date();
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}${month}${day}`;
            };
            const start = formatDate(today);
            const end = start; // Same as start for single day
            
            const parameters = 'ALLSKY_SFC_SW_DWN'; // All Sky Surface Shortwave Downward Irradiance
            const apiUrl = `https://power.larc.nasa.gov/api/temporal/daily/point?parameters=${parameters}&community=RE&longitude=${lon}&latitude=${lat}&start=${start}&end=${end}&format=JSON`;

            try {
                console.log('Fetching data from:', apiUrl);
                const response = await fetch(apiUrl);
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Received data:', JSON.stringify(data, null, 2));
                
                if (data && data.properties && data.properties.parameter && data.properties.parameter[parameters]) {
                    const dateKey = Object.keys(data.properties.parameter[parameters])[0];
                    let radiationValue = parseFloat(data.properties.parameter[parameters][dateKey]);
                    console.log('Raw radiation value:', radiationValue);
                    
                    if (isNaN(radiationValue) || radiationValue === -999) {
                        console.log('No valid data available for this date.');
                        document.getElementById('radiation-value').textContent = 'N/A';
                        document.getElementById('radiation-unit').textContent = '';
                    } else {
                        // Convert to kW/m²
                        const convertedValue = (radiationValue / 24).toFixed(3); // Divide by 24 to convert from kW-hr/m^2/day to kW/m²
                        console.log('Converted radiation value:', convertedValue);
                        document.getElementById('radiation-value').textContent = convertedValue;
                        document.getElementById('radiation-unit').textContent = 'kW/m²';
                    }
                    
                    document.getElementById('radiation-timestamp').textContent = `Data Date: ${new Date(dateKey).toLocaleDateString()}`;
                } else {
                    throw new Error('Unexpected data structure received from API');
                }
            } catch (error) {
                console.error('Error fetching solar radiation data:', error);
                console.error('Error details:', error.message);
                document.getElementById('radiation-value').textContent = 'unavailable';
                document.getElementById('radiation-unit').textContent = '';
                document.getElementById('radiation-timestamp').textContent = '';
            }
            
            // Update every hour (3600000 ms)
            setTimeout(updateSolarRadiation, 3600000);
        }
        
        // Set the year for the copyright
        document.getElementById('year').textContent = new Date().getFullYear();

        // Commented out debugging code for copyright text
        /*
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded');
            const copyrightElement = document.querySelector('.copyright');
            console.log('Copyright element:', copyrightElement);
            if (copyrightElement) {
                const rect = copyrightElement.getBoundingClientRect();
                console.log('Copyright position:', {
                    top: rect.top,
                    right: rect.right,
                    bottom: rect.bottom,
                    left: rect.left
                });
            }
        });
        */

    </script>
</body>
</html>